<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Кулинарные рецепты — Главная</title>
    <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
    <div class="wrap" role="document">
        <header>
            <a class="brand" href="#">
                <div class="logo">ВК</div>
                <div>
                    <div class="brand-name">Вкусно</div>
                    <div class="brand-sub">Кулинарные рецепты</div>
                </div>
            </a>

            <nav aria-label="Главная навигация">
                <ul>
                    <li><a href="#" aria-current="page">Главная</a></li>
                    <li><a href="recept.html">Рецепты</a></li>
                    <li><a href="about.html">О нас</a></li>
                    <li><a href="about.html#contacts">Контакты</a></li>
                    <li class="admin-panel"><a href="admin.html">Войти</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <section class="hero">
                <div class="hero-card">
                    <h1>Простые и вкусные рецепты на каждый день</h1>
                    <p>Минималистичная коллекция проверенных рецептов: завтраки, супы, основные блюда и десерты. Фотографии подбираются под тему для вдохновения.</p>
                    <p class="hero-note">Новые рецепты добавляются каждую неделю — подписывайтесь, чтобы не пропустить.</p>
                    <a class="cta" href="#popular-recept">Открыть коллекцию</a>
                </div>

                <div class="hero-images">
                    <img class="featured-img featured-main" src="https://www.shutterstock.com/image-vector/chef-white-uniform-stirring-food-260nw-2663212241.jpg" alt="Приготовление блюда" loading="lazy" />
                    <div class="hero-thumb-row">
                        <img class="featured-img thumb-img" src="https://img.freepik.com/premium-vector/salad-flat-vector-illustration-salad-hand-drawing-isolated-vector-illustration_501705-431.jpg" alt="Салат" loading="lazy" />
                        <img class="featured-img thumb-img" src="https://avatars.mds.yandex.net/i?id=95308dabc2f54bf790e884c25f5d837742e7c953-4599933-images-thumbs&n=13" alt="Десерт" loading="lazy" />
                    </div>
                </div>
            </section>

            <section id="popular-recept">
                <h2 class="section-title">Популярные рецепты</h2>

                <div class="grid" role="list">
                    <!-- Карточки рецептов будут загружены с помощью JavaScript -->
                </div>
            </section>

            <section class="subscribe" aria-label="Подписка">
                <div style="font-weight:700">Подпишитесь на новые рецепты</div>
                <form onsubmit="event.preventDefault(); alert('Спасибо за подписку!');" aria-label="Форма подписки">
                    <input type="email" placeholder="Ваш email" aria-label="Email" required />
                    <button type="submit">Подписаться</button>
                </form>
            </section>
        </main>

        <footer>
            <div>© <strong>Вкусно</strong> — коллекция рецептов</div>
            <div class="footer-links">
                <a class="footer-link" href="#">Политика</a>
                <a class="footer-link" href="#">Контакты</a>
                <a class="footer-link" href="#">Оферта</a>
            </div>
        </footer>
    </div>
</body>
<script type="module">
import { supabase } from './assets/js/supabase-init.js';

document.addEventListener('DOMContentLoaded', async () => {
  const grid = document.querySelector('.grid');
  if(!grid) return;

  // добавляем сообщение загрузки в секцию, чтобы оно было по центру секции
  const section = grid.closest('section') || grid.parentElement;
  const loading = document.createElement('div');
  loading.className = 'loading-message';
  loading.textContent = 'Загрузка...';
  section.insertBefore(loading, grid);

  try {
    const { data, error } = await supabase
      .from('recipes')
      .select('*')
      .order('created_at', { ascending: false })
      .limit(6);

    // убрать индикатор загрузки
    loading.remove();

    if(error || !data) {
      const err = document.createElement('div');
      err.className = 'loading-message';
      err.textContent = 'Не удалось загрузить рецепты.';
      section.appendChild(err);
      return;
    }

    data.forEach(r => {
      const card = document.createElement('article');
      card.className = "card";
      card.innerHTML = `
        <img src="${r.image_url || 'assets/images/placeholder.png'}" loading="lazy" />
        <div class="card-body">
          <h3 class="card-title">${r.title}</h3>
          <p class="card-desc">${r.description || ''}</p>
          <div class="card-meta">
            <span class="chip">${r.time || ''}</span>
            <a class="card-link" href="recept.html?id=${r.id}">Смотреть</a>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });
  } catch (e) {
    loading.textContent = 'Ошибка загрузки.';
    console.error(e);
  }
});

document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault(); // Предотвращаем стандартное поведение ссылки

    const targetId = this.getAttribute('href');
    const targetElement = document.querySelector(targetId);

    if (targetElement) {
      targetElement.scrollIntoView({
        behavior: 'smooth' // Включаем плавную прокрутку
      });
    }
  });
});

</script>
</html>